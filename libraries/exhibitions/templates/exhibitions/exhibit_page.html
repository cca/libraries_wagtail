{% extends "exhibits-base.html" %}
{% load wagtailcore_tags wagtailimages_tags %}

{% block body_class %}exhibit{% endblock %}

{% block content %}

{% comment %} two templates: one large banner image or four square images {% endcomment %}
{% if page.display_template == 'banner' %}
    {% include 'components/banner.html' %}
{% elif page.display_template == 'foursquare' %}
    {% include 'components/foursquare.html' %}
{% endif %}

<div class="wrapper">

    <div class="wrapper--details">

        <dl class="metadata">
            {% if page.location|striptags != '' %}
                <div class="metadata--element">
                    <dt>Location</dt>
                    <dd>{{page.location|richtext}}</dd>
                </div class="metadata--element">
            {% endif %}

            {% if page.dates|striptags != '' %}
                <div class="metadata--element">
                    <dt>Date(s)</dt>
                    <dd>{{page.dates|richtext}}</dd>
                </div>
            {% endif %}

            {% if page.creators|striptags != '' %}
                <div class="metadata--element">
                    <dt>Creator(s)</dt>
                    <dd>{{page.creators|richtext}}</dd>
                </div>
            {% endif %}

            {% if page.reception|striptags != '' %}
                <div class="metadata--element">
                    <dt>Reception</dt>
                    <dd>{{page.reception|richtext}}</dd>
                </div>
            {% endif %}
        </dl>

        <div class="description">
            {% include_block page.description %}
        </div>
    </div>

    <section class="gallery">
        <h2 class="gallery--title">Gallery</h2>

        <div class="gallery--works js-masonry js-lightgallery">
            {% for work in page.exhibit_artwork.all %}
                {% include 'components/artwork.html' %}
            {% endfor %}
        </div>
    </section>

    {% if page.epilogue %}
        <section class="epilogue">
            {{ page.epilogue|richtext }}
        </section>
    {% endif %}
</div>

{% endblock %}

{% block extra_js %}
{% comment %} TODO: combine/organize these scripts {% endcomment %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/4.2.2/masonry.pkgd.min.js"></script>
<script>
$(()=>{
    $('.js-masonry').masonry({
        "columnWidth": 600,
        "fitWidth": true,
        "gutter": 4,
        "itemSelector": ".js-gallery--work"
    })
})
</script>
{% comment %}
don't need to load this CSS in the head when it won't be used
until the user enters lightGallery
{% endcomment %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.11/css/lightgallery.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.11/js/lightgallery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lg-zoom/1.1.0/lg-zoom.min.js"></script>
<script>
$(() => {
    let options = {
        hideBarsDelay: 3000,
        selector: '.js-gallery--work',
        subHtmlSelectorRelative: true,
        vimeoPlayerParams: {
            byline: false,
            portrait: false,
            title: false
        }
    }
    $lg = $('.js-lightgallery').lightGallery(options);
    console.log($lg)
    $lg.on('onAfterAppendSubHtml.lg', (event, index) => {
        let slide = $('.js-gallery--work').eq(index)
        console.log(slide)
        console.log(slide.find('.lg-video-cont'))
        if (slide.find('.gallery--work__image').length > 0) {
            $('#lg-zoom-in, #lg-zoom-out, #lg-actual-size').show()
        } else (
            $('#lg-zoom-in, #lg-zoom-out, #lg-actual-size').hide()
        )
    })
})
</script>
{% endblock %}
